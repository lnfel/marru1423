<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Decrypt Effect</title>

    <link href="https://fonts.googleapis.com/css2?family=Space+Mono&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/modern-normalize@1.1.0/modern-normalize.css">

    <style>
        body {
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgb(15 23 42);
            color: white;
            padding: 2rem;
            font-size: 4rem;
            font-family: "Space Mono", monospace;
        }
        h1 {
            max-width: min-content;
        }
    </style>
</head>
<body>
    <h1 class="encrypted" data-value="Encrypted message.">Encrypted message.</h1>

    <script>
        /**
         * On mouse over event:
         * - Generate a random number 1-52 using Math.random
         * - Round the number to an absolute value using Math.floor
         * - Assign each letter a random letter from the character set `letters`
         * by splitting and mapping over each letter, then joining the letters back
         * - Do the steps above in an interval of 30 per second
         * - Monitor the iterations by having a state called `iterations` that starts at 0
         * - (1.) For every iteration increase the value by 1 / 3 (a third of our iteration, making the iteration slower)
         * - (2.) If the position of our letter is less than the current iteration
         * use the original letter, otherwise use a random character
         * - When the current iteration is equal to the length of our original text
         * clear the interval (stop the iteration)
         */
        const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"
        let interval = null

        document.querySelector('.encrypted').onmouseover = (event) => {
            let iterations = 0
            clearInterval(interval)

            /**
             * Original code from Hyperplexed
             */
            // interval = setInterval(() => {
            //     event.target.innerText = event.target.innerText.split("")
            //         .map((letter, index) => {
            //             // 2.
            //             if (index < iterations) {
            //                 return event.target.dataset.value[index]
            //             }
            //             return letters[Math.floor(Math.random() * 52)]
            //         })
            //         .join("")

            //     if (iterations >= event.target.dataset.value.length) {
            //         clearInterval(interval)
            //     }
                
            //     // 1.
            //     iterations += 1 / 3
            // }, 30)


            /**
             * Modified code by lnfel
             * Taking into account all steps done on previous working code:
             * - Instead of looping on the text as single word, we now support
             * multiple words by splitting the original text using space " "
             * - Map through each word before mapping on each word's letter
             * - (1.) Instead of relying on a string value for tracking letter index
             * we now use an array of words as the source of truth for each iteration
             * - (2.) If letterIndex is less than the current iteration, use the correct letter
             * of the word, use the original word's index to find the correct letter index
             */

            // 1.
            const originalWords = event.target.dataset.value.split(" ")

            interval = setInterval(() => {
                event.target.innerText = event.target.innerText.split(" ")
                    .map((word, wordIndex) => {
                        return word.split("").map((letter, letterIndex) => {
                            // 2.
                            if (letterIndex < iterations) {
                                return originalWords[wordIndex][letterIndex]
                            }
                            return letters[Math.floor(Math.random() * 52)]
                        })
                        .join("")
                    })
                    .join(" ")

                if (iterations >= event.target.dataset.value.length) {
                    clearInterval(interval)
                }
                
                // 1.
                iterations += 1 / 5
            }, 30)
        }
    </script>
</body>
</html>